{"version":3,"file":"embed.min.js","sources":["../src/embed.js"],"sourcesContent":["// This file is part of Moodle - https://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <https://www.gnu.org/licenses/>.\n\n/**\n * Common values helper for the Moodle tiny_ketcher plugin.\n *\n * @module      tiny_ketcher/embed\n * @copyright   2024 Venkatesan Rangarajan <venkatesanrpu@gmail.com>\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport {\n    get_string as getString\n}\nfrom 'core/str';\nimport Templates from 'core/templates';\nimport Modal from 'core/modal';\nimport Config from 'core/config';\nimport {\n    exception as displayException\n}\nfrom 'core/notification';\n\nexport const KetcherEmbed = class {\n    editor = null;\n    canShowFilePicker = false;\n\n    /**\n     * @property {Object} The names of the alignment options.\n     */\n    helpStrings = null;\n\n    /**\n     * @property {boolean} Indicate that the user is updating the media or not.\n     */\n    isUpdating = false;\n\n    constructor(editor) {\n        this.editor = editor;\n    }\n\n    getIframeURL = () => {\n        const url = new URL(`${Config.wwwroot}/lib/editor/tiny/plugins/ketcher/ketcher/sketch.html`);\n        return url.toString();\n    };\n\n    init = async() => {\n        const modal = await Modal.create({\n            title: getString('ketchertitle', 'tiny_ketcher'),\n            show: true,\n            removeOnClose: true,\n        });\n\n\n\n        var modalDialog = document.querySelector(\".modal-dialog\");\n        var modalContent = document.querySelector(\".modal-content\");\n        var modalBody = document.querySelector(\".modal-body\");\n        var modalFooter = document.querySelector(\".modal-footer\");\n\n        if (window.matchMedia(\"(max-width: 768px)\").matches) {\n            modalDialog.style.cssText = \"width: 90%; height: 90%; margin: 5% auto; padding: 0;\";\n        } else {\n            modalDialog.style.cssText = \"width: 850px; height: 720px; margin: auto; padding: 0;\";\n        }\n\n        modalContent.style.cssText = \"height: 100%; max-height: 100%;\";\n        modalBody.style.cssText = \"padding: 0; height: 80vh; overflow-y:inherit !important\";\n        modalFooter.style.cssText = \"display: inherit; height: 50px;\";\n\n        Templates.renderForPromise('tiny_ketcher/ketcher_iframe', {\n            src: this.getIframeURL()\n        })\n        .then(({\n                html,\n                js\n            }) => {\n            Templates.appendNodeContents(modal.getBody(), html, js);\n            // Get the iframe element\n            const iframe = document.getElementById('tinymce_ketcher-iframe');\n            // Set the height of the iframe to 100%\n            iframe.style.height = '100%';\n            iframe.style.width = '100%';\n            // Add a load event listener to the iframe\n            iframe.addEventListener('load', function () {\n                // Make sure window.ketData is valid\n                if (window.json) {\n                    // Call the ketcher.setMolecule API after a delay\n                    setTimeout(function () {\n                        if (iframe.contentWindow.ketcher) {\n                            iframe.contentWindow.ketcher.setMolecule(window.json);\n                        } else {\n                            window.console.log('ketcher is not defined');\n                        }\n                    }, 1000); // Adjust the delay as needed\n                }\n            });\n\n            // Add the script to the modal footer after the iframe is loaded\n            const scripturl = new URL(`${Config.wwwroot}/lib/editor/tiny/plugins/ketcher/ketcher/sketch.js`);\n            var script = document.createElement('script');\n            script.src = scripturl.toString();\n            var button = document.createElement('button');\n            button.id = \"actionButton\";\n            button.className = \"btn btn-primary\";\n            button.textContent = \"Save\";\n            modal.getFooter().append(button, script);\n\n        })\n        .catch((error) => displayException(error));\n    };\n};\n"],"names":["editor","canShowFilePicker","helpStrings","isUpdating","constructor","getIframeURL","URL","Config","wwwroot","toString","init","async","modal","Modal","create","title","show","removeOnClose","modalDialog","document","querySelector","modalContent","modalBody","modalFooter","window","matchMedia","matches","style","cssText","renderForPromise","src","this","then","_ref","html","js","appendNodeContents","getBody","iframe","getElementById","height","width","addEventListener","json","setTimeout","contentWindow","ketcher","setMolecule","console","log","scripturl","script","createElement","button","id","className","textContent","getFooter","append","catch","error"],"mappings":";;;;;;;4OAmC4B,MACxBA,OAAS,KACTC,mBAAoB,EAKpBC,YAAc,KAKdC,YAAa,EAEbC,YAAYJ,aACHA,OAASA,OAGlBK,aAAe,IACC,IAAIC,IAAK,GAAEC,gBAAOC,+DACnBC,WAGfC,KAAOC,gBACGC,YAAcC,eAAMC,OAAO,CAC7BC,OAAO,mBAAU,eAAgB,gBACjCC,MAAM,EACNC,eAAe,QAKfC,YAAcC,SAASC,cAAc,iBACrCC,aAAeF,SAASC,cAAc,kBACtCE,UAAYH,SAASC,cAAc,eACnCG,YAAcJ,SAASC,cAAc,iBAErCI,OAAOC,WAAW,sBAAsBC,QACxCR,YAAYS,MAAMC,QAAU,wDAE5BV,YAAYS,MAAMC,QAAU,yDAGhCP,aAAaM,MAAMC,QAAU,kCAC7BN,UAAUK,MAAMC,QAAU,0DAC1BL,YAAYI,MAAMC,QAAU,qDAElBC,iBAAiB,8BAA+B,CACtDC,IAAKC,KAAK1B,iBAEb2B,MAAKC,WAACC,KACCA,KADDC,GAECA,4BAEMC,mBAAmBxB,MAAMyB,UAAWH,KAAMC,UAE9CG,OAASnB,SAASoB,eAAe,0BAEvCD,OAAOX,MAAMa,OAAS,OACtBF,OAAOX,MAAMc,MAAQ,OAErBH,OAAOI,iBAAiB,QAAQ,WAExBlB,OAAOmB,MAEPC,YAAW,WACHN,OAAOO,cAAcC,QACrBR,OAAOO,cAAcC,QAAQC,YAAYvB,OAAOmB,MAEhDnB,OAAOwB,QAAQC,IAAI,4BAExB,cAKLC,UAAY,IAAI5C,IAAK,GAAEC,gBAAOC,iEAChC2C,OAAShC,SAASiC,cAAc,UACpCD,OAAOrB,IAAMoB,UAAUzC,eACnB4C,OAASlC,SAASiC,cAAc,UACpCC,OAAOC,GAAK,eACZD,OAAOE,UAAY,kBACnBF,OAAOG,YAAc,OACrB5C,MAAM6C,YAAYC,OAAOL,OAAQF,WAGpCQ,OAAOC,QAAU,2BAAiBA"}