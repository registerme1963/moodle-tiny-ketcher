define("tiny_keteditor/embed",["exports","core/str","core/templates","core/modal","core/config","core/notification"],(function(_exports,_str,_templates,_modal,_config,_notification){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * Common values helper for the Moodle tiny_keteditor plugin.
   *
   * @module      tiny_keteditor/embed
   * @copyright   2024 Venkatesan Rangarajan <venkatesanrpu@gmail.com>
   * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.saveData=_exports.ketcherEmbed=void 0,_templates=_interopRequireDefault(_templates),_modal=_interopRequireDefault(_modal),_config=_interopRequireDefault(_config);_exports.ketcherEmbed=class{editor=null;constructor(editor){this.editor=editor}init=async()=>{const modal=await _modal.default.create({title:(0,_str.get_string)("buttonNameTitle","tiny_keteditor"),show:!0,removeOnClose:!0});_templates.default.renderForPromise("tiny_keteditor/ketcher_template",{}).then((async _ref=>{let{html:html,js:js}=_ref;_templates.default.appendNodeContents(modal.getBody(),html,js);const scripturl=new URL(`${_config.default.wwwroot}/lib/editor/tiny/plugins/keteditor/ketcher/static/js/main.963f80c2.js`);var script=document.createElement("script");script.src=scripturl.toString(),document.body.appendChild(script);const cssurl=new URL(`${_config.default.wwwroot}/lib/editor/tiny/plugins/keteditor/ketcher/static/css/main.3fc9c0f8.css`);var link=document.createElement("link");link.href=cssurl.toString(),link.rel="stylesheet",document.head.appendChild(link)})).catch((error=>(0,_notification.exception)(error)))};waitForKetcher=()=>new Promise(((resolve,reject)=>{const checkKetcher=setInterval((()=>{window.ketcher&&(clearInterval(checkKetcher),resolve(window.ketcher))}),100);setTimeout((()=>{clearInterval(checkKetcher),reject(new Error("Ketcher loading timeout"))}),5e3)}))};_exports.saveData=async function(){var ketcher=window.ketcher,struct=await ketcher.getKet(),image=await ketcher.generateImage(struct,{outputFormat:"svg",backgroundColor:"255, 255, 255"}),reader=new FileReader;reader.addEventListener("load",(function(){var base64Image=reader.result,svgElement=(new DOMParser).parseFromString(atob(base64Image.split(",")[1]),"image/svg+xml").documentElement,width=svgElement.getAttribute("width"),height=svgElement.getAttribute("height");if(window.parent.tinyMCE&&window.parent.tinyMCE.activeEditor){var url=URL.createObjectURL(image),ketStruct=JSON.stringify(struct).replace(/\\n/g,"").replace(/\\"/g,'"').replace(/ /g,"").slice(1,-1),content='<img src="'+url+'" width="'+width+'" height="'+height+'">';window.parent.tinyMCE.activeEditor.execCommand("mceInsertContent",0,content),window.parent.tinyMCE.activeEditor.execCommand("mceInsertContent",0,"\x3c!--"+ketStruct+"--\x3e")}else window.console.log("TinyMCE not initialized");window.parent.document.querySelector(".modal .close").click()})),reader.readAsDataURL(image)}}));

//# sourceMappingURL=embed.min.js.map