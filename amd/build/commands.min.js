define("tiny_keteditor/commands",["exports","editor_tiny/utils","core/str","./common","./embed"],(function(_exports,_utils,_str,_common,_embed){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.getSetup=void 0;
/**
   * Common values helper for the Moodle tiny_keteditor plugin.
   *
   * @module      tiny_keteditor/commands
   * @copyright   2024 Venkatesan Rangarajan <venkatesanrpu@gmail.com>
   * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */
const isImage=node=>"img"===node.nodeName.toLowerCase(),handleAction=async editor=>{const ketcherImage=new _embed.ketcherEmbed(editor);ketcherImage.init();try{const ketcher=await ketcherImage.waitForKetcher();window.json?(window.console.log("molecule loading...",window.json),ketcher.setMolecule(window.json)):window.console.log("Ketcher Molecular Data Not Available")}catch(error){window.console.error(error.message)}document.getElementById("actionButton").addEventListener("click",_embed.saveData)};_exports.getSetup=async()=>{const[buttonNameTitle,buttonImage]=await Promise.all([(0,_str.get_string)("buttonNameTitle",_common.component),(0,_utils.getButtonImage)("icon",_common.component)]);return editor=>{editor.ui.registry.addIcon(_common.icon,buttonImage.html),editor.ui.registry.addButton(_common.buttonName,{icon:_common.icon,tooltip:buttonNameTitle,onAction:()=>handleAction(editor)}),editor.ui.registry.addToggleButton(_common.buttonName,{icon:_common.icon,tooltip:buttonNameTitle,onAction:()=>handleAction(editor,window.json),onSetup:api=>editor.selection.selectorChangedWithUnbind("img:not([data-mce-object]):not([data-mce-placeholder]),figure.image",(function(){var parentNode=editor.selection.getNode().parentNode;const commentMatch=editor.serializer.serialize(parentNode).match(/<!--(.*?)-->/);if(commentMatch)try{var json=JSON.parse(commentMatch[1]);api.setActive(!0),window.json=JSON.stringify(json)}catch(e){api.setActive(!1)}else api.setActive(!1)})).unbind}),editor.ui.registry.addContextToolbar(_common.buttonName,{predicate:isImage,items:_common.buttonName,position:"node",scope:"node"}),editor.ui.registry.addMenuItem(_common.buttonName,{icon:_common.icon,text:buttonNameTitle,onAction:()=>handleAction(editor)})}}}));

//# sourceMappingURL=commands.min.js.map